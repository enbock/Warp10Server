machine:
  services:
    - docker

dependencies:
  override:
    - docker info
    - docker build --rm=false -t enbock/warp10server:dev "docker/dev"

test:
  override:
    - docker run -it -v "$PWD:/src" -v "$HOME:/root" -w "/src" --name W10SDev enbock/warp10server:dev "bash -c 'export CFLAGS=-FPS=2000; make'"

deployment:
  feature:
    branch: /feature.*/
    commands:
      - cp -v warp10server/warp10* docker/run
      - docker build --rm=false -t enbock/warp10server "docker/run"
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker push enbock/warp10server
